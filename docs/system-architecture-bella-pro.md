# 智慧社區配送系統 - 系統架構圖（貝拉 Pro 方案）

**版本**: v1.1
**日期**: 2025/12/30
**用途**: 機構/電控/軟體 跨部門溝通

---

## 1. 系統總覽

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    系統總覽                                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                                 ┌─────────────────────┐
                                 │      和椿雲平台      │
                                 │   (SWAT Platform)   │
                                 └──────────┬──────────┘
                                            │
                        ┌───────────────────┼───────────────────┐
                        │                   │                   │
                        ▼                   ▼                   ▼
               ┌────────────────┐  ┌────────────────┐  ┌────────────────┐
               │    大廳站       │  │   貝拉 Pro     │  │    樓層站      │
               │  Lobby Station │  │   Bella PRO    │  │  Floor Station │
               └────────────────┘  └────────────────┘  └────────────────┘
                        │                   │                   │
                        │                   │                   │
                        ▼                   ▼                   ▼
               ┌────────────────┐  ┌────────────────┐  ┌────────────────┐
               │    外送員       │  │  電梯系統      │  │     住戶       │
               │    快遞員       │  │   Elevator     │  │   Resident     │
               └────────────────┘  └────────────────┘  └────────────────┘
```

---

## 2. 硬體架構圖（機構 + 電控）

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                  硬體架構圖                                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘


    【大廳站】                      【貝拉 Pro】                    【樓層站】

    ┌─────────────────┐            ┌─────────────────┐            ┌─────────────────┐
    │ ┌─────────────┐ │            │                 │            │ ┌─────────────┐ │
    │ │  觸控螢幕   │ │            │    ┌───────┐    │            │ │  觸控螢幕   │ │
    │ │  10" LCD    │ │            │    │ 螢幕  │    │            │ │  10" LCD    │ │
    │ └─────────────┘ │            │    └───────┘    │            │ └─────────────┘ │
    │                 │            │                 │            │                 │
    │ ┌─────────────┐ │            │ ┌─────────────┐ │            │ ┌─────────────┐ │
    │ │    暫存     │ │            │ │   托盤 3    │ │            │ │    暫存     │ │
    │ │    10格     │ │            │ ├─────────────┤ │            │ │    5格      │ │
    │ │  (雙列)     │ │            │ │   托盤 2    │ │            │ │  (單列)     │ │
    │ │             │ │            │ ├─────────────┤ │            │ │             │ │
    │ └─────────────┘ │            │ │ ★托盤 1★  │◄─對接層      │ └─────────────┘ │
    │                 │            │ └─────────────┘ │            │                 │
    │ ┌─────────────┐ │            │                 │            │ ┌─────────────┐ │
    │ │  ★開口★   │ │            │ ┌─────────────┐ │            │ │  ★開口★   │ │
    │ │  投件/取件  │ │            │ │   底盤      │ │            │ │  投件/取件  │ │
    │ └─────────────┘ │            │ │  雷達+輪子  │ │            │ └─────────────┘ │
    │                 │            │ └─────────────┘ │            │                 │
    │ ┌─────────────┐ │            │                 │            │ ┌─────────────┐ │
    │ │ ★推送機構★│═══════════════════════════════════════════════│ ★推送機構★│ │
    │ │  AMR對接   │ │◄──────────►│                 │◄──────────►│  AMR對接    │ │
    │ └─────────────┘ │   對接      └─────────────────┘   對接      └─────────────┘ │
    │                 │                                            │                 │
    └─────────────────┘                                            └─────────────────┘

          │                              │                              │
          ▼                              ▼                              ▼
    ┌─────────────────┐            ┌─────────────────┐            ┌─────────────────┐
    │   站點控制器     │            │  普渡雲平台      │            │   站點控制器     │
    │   (ARM/STM32)   │            │  Pudu Cloud     │            │   (ARM/STM32)   │
    └─────────────────┘            └─────────────────┘            └─────────────────┘
```

---

## 3. 站點機構詳細圖

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              站點機構詳細圖（側視圖）                                     │
└─────────────────────────────────────────────────────────────────────────────────────────┘

    【站點側視圖 - 推送機構設計】

    前方（使用者）                                              後方（AMR 對接）
         │                                                           │
         ▼                                                           ▼

    ┌────────────────────────────────────────────────────────────────────────────┐
    │                                                                            │
    │                            暫存區                                          │
    │    ┌──────────────────────────────────────────────────────────────────┐   │
    │    │                                                                  │   │
    │    │    ╔═══════════════════════╗                                    │   │
    │    │    ║        箱體           ║   深度 40cm                        │   │
    │    │    ╚═══════════════════════╝                                    │   │
    │    │              │                                                   │   │
    │    │         ┌────┴────┐                                             │   │
    │    │         │ 升降機  │                                             │   │
    │    │         └────┬────┘                                             │   │
    │    │              │                                                   │   │
    │    └──────────────┼──────────────────────────────────────────────────┘   │
    │                   │                                                       │
    │    ┌──────────────┴──────────────────────────────────────────────────┐   │
    │    │              開口（投件/取件）                                   │   │
    │    └──────────────┬──────────────────────────────────────────────────┘   │
    │                   │                                                       │
    │    ┌──────────────┴──────────────────────────────────────────────────┐   │
    │    │                                                                  │   │
    │    │    ╔═══════════════════════╗     ════════════════════►          │   │
    │    │    ║        箱體           ║ ══► ★ 伸縮推送機構 ★ ════►        │══► AMR
    │    │    ╚═══════════════════════╝     ════════════════════►          │   │
    │    │                                                                  │   │
    │    │                        AMR 對接層                                │   │
    │    └─────────────────────────────────────────────────────────────────┘   │
    │                                                                            │
    └────────────────────────────────────────────────────────────────────────────┘

    │◄── 3cm ──►│◄───── 40cm ─────►│◄── 10cm ──►│◄──── 25cm ────►│◄── 2cm ──►│
       開口門         箱體深度          升降機       推送機構伸縮      結構

    │◄─────────────────────────── 深度 80cm ─────────────────────────────────►│
                                    (增加 20cm)
```

---

## 4. 推送機構設計選項

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              推送機構設計選項                                            │
└─────────────────────────────────────────────────────────────────────────────────────────┘

【選項 A：伸縮皮帶】推薦 ★

    收縮狀態                              伸出狀態

    ┌───────────────────┐                ┌───────────────────┬═══════════════════┐
    │ ╔═══════════════╗ │                │ ╔═══════════════╗ │                   │
    │ ║     箱體      ║ │                │ ║     箱體      ║═══════════════════►│ AMR托盤
    │ ╚═══════════════╝ │                │ ╚═══════════════╝ │                   │
    │ ═══════════════   │                │ ═══════════════════════════════════  │
    │     皮帶          │                │          皮帶伸出                     │
    └───────────────────┘                └───────────────────┴═══════════════════┘

    優點：平穩、可控速度、雙向運作
    缺點：機構較複雜
    成本：~12,000 TWD


【選項 B：推桿 + 皮帶】

    收縮狀態                              伸出狀態

    ┌───────────────────┐                ┌───────────────────┬───────────────────┐
    │ ╔═══════════════╗ │                │         ╔═══════════════╗             │
    │ ║     箱體      ║ │                │  推桿══►║     箱體      ║════════════►│ AMR托盤
    │ ╚═══════════════╝ │                │         ╚═══════════════╝             │
    │ ═══════════════   │                │ ═══════════════════════════════════  │
    │   底部皮帶        │                │   底部皮帶（輔助滑動）                │
    └───────────────────┘                └───────────────────┴───────────────────┘

    優點：結構簡單
    缺點：回收需另外機構
    成本：~8,000 TWD


【選項 C：剪刀叉】

    收縮狀態                              伸出狀態

    ┌───────────────────┐                ┌───────────────────┬═══════════════════┐
    │ ╔═══════════════╗ │                │                   │╔═══════════════╗  │
    │ ║     箱體      ║ │                │    ╱╲  ╱╲  ╱╲    │║     箱體      ║══►│ AMR托盤
    │ ╚═══════════════╝ │                │   ╱  ╲╱  ╲╱  ╲   │╚═══════════════╝  │
    │   ══╱╲╱╲══        │                │  ══════════════════                  │
    │   剪刀叉機構      │                │     剪刀叉伸出                        │
    └───────────────────┘                └───────────────────┴═══════════════════┘

    優點：伸縮比大、穩定
    缺點：高度會變化
    成本：~15,000 TWD
```

---

## 5. AMR 對接詳細圖

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              AMR 對接詳細圖（俯視圖）                                    │
└─────────────────────────────────────────────────────────────────────────────────────────┘

【對接流程】

    Step 1: AMR 到達                    Step 2: 對位確認

    ┌─────────────┐                     ┌─────────────┐
    │             │                     │             │
    │   站點      │      ┌─────┐       │   站點      │      ┌─────┐
    │             │      │ AMR │       │             │◄────►│ AMR │
    │  ═══════   │      │     │       │  ═══════   │      │     │
    │  推送機構   │      └─────┘       │  推送機構   │      └─────┘
    │             │                     │             │
    └─────────────┘                     └─────────────┘
                          ↓                              ↓
                     AMR 導航到           感測器確認對位
                     對接點              (紅外/光電/視覺)


    Step 3: 推送箱體                    Step 4: 完成確認

    ┌─────────────┐                     ┌─────────────┐
    │             │                     │             │
    │   站點      │      ┌─────┐       │   站點      │      ┌─────┐
    │ ╔═══╗      │      │     │       │             │      │╔═══╗│
    │ ║箱 ║═══════════► │     │       │  ═══════   │      │║箱 ║│
    │ ╚═══╝      │      │     │       │             │      │╚═══╝│
    │             │      └─────┘       │             │      └─────┘
    └─────────────┘                     └─────────────┘
                          ↓                              ↓
                    伸縮皮帶推出          感測器確認箱體
                    箱體到托盤           已在 AMR 托盤上


【對位感測器配置】

              ┌─────────────────────────────────────┐
              │               站點                   │
              │                                     │
              │    [光電1]              [光電2]     │  ← 偵測 AMR 到位
              │         ╲              ╱            │
              │          ╲            ╱             │
              │           ╲          ╱              │
              │    ════════════════════════        │
              │         推送機構出口                │
              │                                     │
              │         [光電3]                    │  ← 偵測箱體通過
              │                                     │
              └─────────────────────────────────────┘
                              │
                              │  對接間距 5cm
                              ▼
              ┌─────────────────────────────────────┐
              │              貝拉 Pro                │
              │                                     │
              │         ┌───────────────┐          │
              │         │    托盤 1     │          │  ← 對接托盤
              │         │   (對接層)    │          │
              │         └───────────────┘          │
              │                                     │
              └─────────────────────────────────────┘
```

---

## 6. 軟體架構圖

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                   軟體架構圖                                             │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                         │
│                              【和椿雲平台 SWAT Platform】                                │
│                                                                                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │
│  │   訂單管理       │  │   調度引擎       │  │   設備管理       │  │   用戶介面       │   │
│  │  Order Mgmt     │  │  Dispatcher     │  │  Device Mgmt    │  │  User Portal    │   │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘   │
│           │                    │                    │                    │             │
│           └────────────────────┼────────────────────┼────────────────────┘             │
│                                │                    │                                   │
│                                ▼                    ▼                                   │
│                    ┌───────────────────────────────────────────┐                       │
│                    │              訊息佇列 (MQTT/Kafka)         │                       │
│                    └───────────────────────────────────────────┘                       │
│                                         │                                               │
└─────────────────────────────────────────┼───────────────────────────────────────────────┘
                                          │
            ┌─────────────────────────────┼─────────────────────────────┐
            │                             │                             │
            ▼                             ▼                             ▼
┌───────────────────────┐    ┌───────────────────────┐    ┌───────────────────────┐
│                       │    │                       │    │                       │
│   【站點控制系統】     │    │  【普渡雲平台 API】   │    │   【電梯控制系統】    │
│   Station Controller  │    │   Pudu Cloud API     │    │  Elevator Controller  │
│                       │    │                       │    │                       │
│  ┌─────────────────┐ │    │  ┌─────────────────┐ │    │  ┌─────────────────┐ │
│  │  任務執行       │ │    │  │  發起呼叫任務   │ │    │  │  樓層呼叫       │ │
│  │  Task Executor  │ │    │  │  Custom Call    │ │    │  │  Floor Call     │ │
│  ├─────────────────┤ │    │  ├─────────────────┤ │    │  ├─────────────────┤ │
│  │  機構控制       │ │    │  │  位置監控       │ │    │  │  開門控制       │ │
│  │  Motion Ctrl    │ │    │  │  Robot Pose     │ │    │  │  Door Control   │ │
│  ├─────────────────┤ │    │  ├─────────────────┤ │    │  └─────────────────┘ │
│  │  感測器監控     │ │    │  │  狀態回調       │ │    │                       │
│  │  Sensor Monitor │ │    │  │  Callbacks      │ │    │                       │
│  └─────────────────┘ │    │  └─────────────────┘ │    │                       │
│                       │    │                       │    │                       │
│  通訊: MQTT + RS485   │    │  通訊: HTTPS + WS    │    │  通訊: Modbus/CAN    │
│                       │    │                       │    │                       │
└───────────────────────┘    └───────────────────────┘    └───────────────────────┘
            │                             │                             │
            ▼                             ▼                             ▼
┌───────────────────────┐    ┌───────────────────────┐    ┌───────────────────────┐
│      大廳站/樓層站     │    │       貝拉 Pro        │    │        電梯          │
│        硬體           │    │         AMR          │    │      Elevator        │
└───────────────────────┘    └───────────────────────┘    └───────────────────────┘
```

---

## 7. 通訊架構圖

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                   通訊架構圖                                             │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────────┐
                              │     Internet        │
                              │      雲端           │
                              └──────────┬──────────┘
                                         │
                    ┌────────────────────┼────────────────────┐
                    │                    │                    │
                    ▼                    ▼                    ▼
           ┌────────────────┐   ┌────────────────┐   ┌────────────────┐
           │  和椿雲平台     │   │  普渡雲平台     │   │  物業管理系統   │
           │  SWAT Cloud    │   │  Pudu Cloud    │   │  Property Sys  │
           └───────┬────────┘   └───────┬────────┘   └───────┬────────┘
                   │                    │                    │
                   │ HTTPS              │ HTTPS              │ API
                   │ WebSocket          │ Callback           │
                   │                    │                    │
                   └────────────────────┼────────────────────┘
                                        │
                              ┌─────────┴─────────┐
                              │   社區內網路由器   │
                              │   Local Router    │
                              └─────────┬─────────┘
                                        │
                   ┌────────────────────┼────────────────────┐
                   │                    │                    │
                   ▼                    ▼                    ▼
          ┌────────────────┐   ┌────────────────┐   ┌────────────────┐
          │                │   │                │   │                │
          │    大廳站       │   │   貝拉 Pro     │   │    樓層站 ×N   │
          │  主控制器       │   │    (WiFi)     │   │   子控制器      │
          │                │   │                │   │                │
          └───────┬────────┘   └────────────────┘   └───────┬────────┘
                  │                                          │
                  │ RS485                                    │ RS485
                  │ 有線                                     │ 有線
                  ▼                                          ▼
          ┌────────────────┐                        ┌────────────────┐
          │  升降機/推送    │                        │  升降機/推送    │
          │  感測器/螢幕    │                        │  感測器/螢幕    │
          └────────────────┘                        └────────────────┘


【通訊協議表】

┌──────────────────┬────────────────┬────────────────┬────────────────┐
│ 連線             │ 協議           │ 用途           │ 備註           │
├──────────────────┼────────────────┼────────────────┼────────────────┤
│ 雲平台 ↔ 站點    │ MQTT over TLS  │ 指令下發/狀態上報│ QoS 1         │
│ 雲平台 ↔ 普渡    │ HTTPS + WS     │ AMR 調度/回調  │ 普渡 API       │
│ 站點 ↔ 機構      │ RS485          │ 馬達/感測器控制 │ Modbus RTU    │
│ 站點 ↔ 螢幕      │ HDMI + USB     │ 顯示/觸控      │ 本地           │
│ AMR ↔ 普渡雲     │ WiFi           │ 導航/任務      │ 普渡自有協議   │
└──────────────────┴────────────────┴────────────────┴────────────────┘
```

---

## 8. 配送流程時序圖

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                配送流程時序圖                                            │
└─────────────────────────────────────────────────────────────────────────────────────────┘

    外送員      大廳站       和椿雲       普渡雲      貝拉Pro      電梯       樓層站       住戶
      │          │           │           │           │          │          │          │
      │  掃碼    │           │           │           │          │          │          │
      ├─────────►│           │           │           │          │          │          │
      │          │  訂單確認  │           │           │          │          │          │
      │          ├──────────►│           │           │          │          │          │
      │          │           │           │           │          │          │          │
      │          │◄──────────┤ 分配箱體   │           │          │          │          │
      │          │           │           │           │          │          │          │
      │   放入   │ 開口+開門  │           │           │          │          │          │
      ├─────────►│           │           │           │          │          │          │
      │          │           │           │           │          │          │          │
      │          │  排程請求  │           │           │          │          │          │
      │          ├──────────►│           │           │          │          │          │
      │          │           │           │           │          │          │          │
      │          │           │ 呼叫AMR   │           │          │          │          │
      │          │           ├──────────►│           │          │          │          │
      │          │           │           │  任務下發  │          │          │          │
      │          │           │           ├──────────►│          │          │          │
      │          │           │           │           │          │          │          │
      │          │           │           │           │ 導航到    │          │          │
      │          │           │           │           │ 大廳站    │          │          │
      │          │           │           │           ├─────────►│          │          │
      │          │           │           │           │          │          │          │
      │          │           │           │◄──────────┤ 到達回調  │          │          │
      │          │           │◄──────────┤           │          │          │          │
      │          │◄──────────┤ AMR到達   │           │          │          │          │
      │          │           │           │           │          │          │          │
      │          │ 對位確認   │           │           │          │          │          │
      │          ├──────────────────────────────────►│          │          │          │
      │          │           │           │           │          │          │          │
      │          │ 推送箱體   │           │           │          │          │          │
      │          ├──────────────────────────────────►│ 箱體上托盤│          │          │
      │          │           │           │           │          │          │          │
      │          │ 推送完成   │           │           │          │          │          │
      │          ├──────────►│           │           │          │          │          │
      │          │           │           │           │          │          │          │
      │          │           │ 呼叫樓層   │           │          │          │          │
      │          │           ├──────────►│           │          │          │          │
      │          │           │           │  任務下發  │          │          │          │
      │          │           │           ├──────────►│          │          │          │
      │          │           │           │           │          │          │          │
      │          │           │           │           │ 呼叫電梯  │          │          │
      │          │           │           │           ├─────────►│          │          │
      │          │           │           │           │          │          │          │
      │          │           │           │           │◄─────────┤ 電梯到達 │          │
      │          │           │           │           │          │          │          │
      │          │           │           │           │ 搭電梯上樓│          │          │
      │          │           │           │           ├─────────►│          │          │
      │          │           │           │           │          │          │          │
      │          │           │           │           │ 導航到    │          │          │
      │          │           │           │           │ 樓層站    │          │          │
      │          │           │           │           ├─────────────────────►│          │
      │          │           │           │           │          │          │          │
      │          │           │           │◄──────────┤ 到達回調  │          │          │
      │          │           │◄──────────┤           │          │          │          │
      │          │           │           │           │          │          │          │
      │          │           │ 指令樓層站接收        │          │          │          │
      │          │           ├────────────────────────────────────────────►│          │
      │          │           │           │           │          │          │          │
      │          │           │           │           │          │  對位確認│          │
      │          │           │           │           │◄─────────────────────┤          │
      │          │           │           │           │          │          │          │
      │          │           │           │           │          │  拉取箱體│          │
      │          │           │           │           │──────────────────────►│          │
      │          │           │           │           │          │          │          │
      │          │           │           │           │          │  接收完成│          │
      │          │           │◄──────────────────────────────────────────────┤          │
      │          │           │           │           │          │          │          │
      │          │           │ 通知住戶   │           │          │          │          │
      │          │           ├───────────────────────────────────────────────────────►│
      │          │           │           │           │          │          │          │
      │          │           │           │           │          │          │  取件    │
      │          │           │           │           │          │          │◄─────────┤
      │          │           │           │           │          │          │          │
```

---

## 9. 電控架構圖

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                   電控架構圖                                             │
└─────────────────────────────────────────────────────────────────────────────────────────┘

【大廳站電控】

    ┌─────────────────────────────────────────────────────────────────────────────────┐
    │                              大廳站控制箱                                        │
    │                                                                                 │
    │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
    │  │   電源模組   │    │   主控板    │    │  RS485模組  │    │  WiFi模組   │      │
    │  │  24V/12V/5V │    │ ARM Cortex  │    │  通訊介面   │    │  MQTT通訊   │      │
    │  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘    └──────┬──────┘      │
    │         │                  │                  │                  │              │
    │         └──────────────────┴──────────────────┴──────────────────┘              │
    │                                    │                                            │
    └────────────────────────────────────┼────────────────────────────────────────────┘
                                         │
              ┌──────────────────────────┼──────────────────────────┐
              │                          │                          │
              ▼                          ▼                          ▼
    ┌─────────────────┐        ┌─────────────────┐        ┌─────────────────┐
    │   升降機驅動     │        │   推送機構驅動   │        │    感測器組     │
    │                 │        │                 │        │                 │
    │  • 步進馬達     │        │  • 步進馬達     │        │  • 光電×6      │
    │  • 編碼器       │        │  • 皮帶驅動     │        │  • 紅外對射×2  │
    │  • 限位開關×2   │        │  • 限位開關×2   │        │  • 接近開關×4  │
    └─────────────────┘        └─────────────────┘        └─────────────────┘

    ┌─────────────────┐        ┌─────────────────┐        ┌─────────────────┐
    │   人機介面       │        │   門控模組       │        │   電磁鎖模組    │
    │                 │        │                 │        │                 │
    │  • 10" 觸控螢幕 │        │  • 開口門驅動   │        │  • 箱體電磁鎖   │
    │  • 掃碼器       │        │  • 馬達×1       │        │  • 觸發器×1     │
    │  • NFC讀卡機    │        │                 │        │                 │
    └─────────────────┘        └─────────────────┘        └─────────────────┘


【I/O 清單】

┌──────────────┬──────────┬──────────┬──────────────────────────────┐
│ 類型         │ 數量     │ 電壓     │ 用途                         │
├──────────────┼──────────┼──────────┼──────────────────────────────┤
│ 數位輸入 DI  │ 16       │ 24V      │ 限位、光電、門狀態           │
│ 數位輸出 DO  │ 8        │ 24V      │ 電磁鎖、指示燈               │
│ RS485        │ 2        │ -        │ 馬達驅動、擴展板             │
│ USB          │ 3        │ 5V       │ 螢幕、掃碼器、讀卡機         │
│ Ethernet     │ 1        │ -        │ 網路通訊                     │
└──────────────┴──────────┴──────────┴──────────────────────────────┘
```

---

## 10. 關鍵尺寸匯總

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                  關鍵尺寸匯總（機構設計用）                               │
└─────────────────────────────────────────────────────────────────────────────────────────┘

【待確認：貝拉 Pro 托盤規格】 ⚠️

┌────────────────────────┬────────────────────┬────────────────────┐
│ 項目                   │ 專案需求           │ 貝拉 Pro（待確認） │
├────────────────────────┼────────────────────┼────────────────────┤
│ 托盤尺寸               │ ≥ 45cm × 40cm      │ ？？？             │
│ 對接層高度             │ 35cm               │ 托盤1高度 ？？？   │
│ 托盤邊框               │ 無邊框或低邊框     │ ？？？             │
│ 定位精度               │ ±3cm               │ ？？？             │
│ 載重                   │ ≥ 5kg/層           │ ？？？             │
└────────────────────────┴────────────────────┴────────────────────┘


【站點尺寸（調整後）】

┌────────────────────────┬────────────────────┬────────────────────┐
│ 項目                   │ 大廳站             │ 樓層站             │
├────────────────────────┼────────────────────┼────────────────────┤
│ 寬度                   │ 140 cm             │ 95 cm              │
│ 高度                   │ 200 cm             │ 200 cm             │
│ 深度（原設計）         │ 60 cm              │ 60 cm              │
│ 深度（含推送機構）     │ 80 cm (+20cm)      │ 80 cm (+20cm)      │
│ 推送機構伸出距離       │ 25 cm              │ 25 cm              │
│ AMR 對接高度           │ 35 cm（配合托盤1） │ 35 cm              │
└────────────────────────┴────────────────────┴────────────────────┘


【箱體尺寸（不變）】

┌──────┬─────────────────┬─────────────────┐
│ 尺寸 │ 外部 (W×H×D)    │ 適用托盤尺寸    │
├──────┼─────────────────┼─────────────────┤
│ S    │ 35×25×40 cm     │ 需 ≥ 35×40 cm   │
├──────┼─────────────────┼─────────────────┤
│ M    │ 45×35×40 cm     │ 需 ≥ 45×40 cm   │
└──────┴─────────────────┴─────────────────┘


【對接間距】

    站點推送機構出口 ←──── 5cm ────► 貝拉 Pro 托盤邊緣
                     └───────────┘
                       對接間距
```

---

## 11. 通訊架構與網路安全

### 11.1 WiFi 風險分析

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                WiFi 風險分析                                             │
└─────────────────────────────────────────────────────────────────────────────────────────┘

【信號不穩定風險】

┌─────────────────────┬─────────────────────────────────┬──────────┐
│ 風險場景            │ 影響                            │ 嚴重度   │
├─────────────────────┼─────────────────────────────────┼──────────┤
│ 電梯內              │ AMR 斷線、任務中斷              │ 高       │
│ 地下室/死角         │ 無法接收指令                    │ 高       │
│ 多設備干擾          │ 延遲增加、封包丟失              │ 中       │
│ 穿牆損耗            │ 信號衰減                        │ 中       │
└─────────────────────┴─────────────────────────────────┴──────────┘


【資安風險】

┌─────────────────────┬─────────────────────────────────┬──────────┐
│ 風險類型            │ 說明                            │ 嚴重度   │
├─────────────────────┼─────────────────────────────────┼──────────┤
│ 中間人攻擊          │ 攔截/竄改指令                   │ 高       │
│ 封包竊聽            │ 洩漏配送資訊                    │ 中       │
│ 未授權控制          │ 惡意操控 AMR                    │ 高       │
│ DoS 攻擊            │ 癱瘓系統                        │ 中       │
└─────────────────────┴─────────────────────────────────┴──────────┘
```

### 11.2 建議方案：WiFi + 4G 雙網路備援 ★

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              雙網路備援架構                                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────┐
                              │    和椿雲平台    │
                              └────────┬────────┘
                                       │
                         ┌─────────────┴─────────────┐
                         │                           │
                         ▼                           ▼
                 ┌──────────────┐           ┌──────────────┐
                 │  WiFi 通道   │           │  4G/5G 通道  │
                 │    主要      │           │    備援      │
                 └──────┬───────┘           └──────┬───────┘
                        │                          │
                        └────────────┬─────────────┘
                                     │
                                     ▼
                       ┌──────────────────────────┐
                       │      站點控制器          │
                       │       (雙網卡)           │
                       │                          │
                       │   WiFi ◉      ◉ 4G/5G   │
                       │   優先        備援       │
                       └──────────────────────────┘


【自動切換邏輯】

    ┌────────────────┐
    │   WiFi 正常    │───► 使用 WiFi（低延遲、免費）
    └───────┬────────┘
            │ 斷線 / 延遲 > 500ms
            ▼
    ┌────────────────┐
    │  切換 4G/5G    │───► 維持任務不中斷
    └───────┬────────┘
            │ WiFi 恢復
            ▼
    ┌────────────────┐
    │   切回 WiFi    │───► 節省流量
    └────────────────┘


【WiFi 部署規劃】

    樓層 1    ◉ AP ────────────────────── ◉ AP
               │                            │
    樓層 2    ◉ AP ────────────────────── ◉ AP
               │         Mesh 網路          │
    樓層 3    ◉ AP ────────────────────── ◉ AP
               │                            │
    電梯      ◉ AP（電梯專用 AP）

    • 企業級 AP（Ubiquiti / Aruba / Cisco）
    • Mesh 網路無縫漫遊
    • 電梯內獨立 AP
    • 5GHz 優先（干擾少）
```

### 11.3 資安防護架構

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                 資安防護架構                                             │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                         ┌─────────────────────────────┐
                         │         和椿雲平台          │
                         │                             │
                         │  ┌───────────────────────┐ │
                         │  │     API Gateway       │ │
                         │  │   • JWT Token 驗證    │ │
                         │  │   • Rate Limiting     │ │
                         │  │   • IP 白名單         │ │
                         │  └───────────────────────┘ │
                         │             │               │
                         │  ┌──────────▼────────────┐ │
                         │  │    TLS 1.3 加密       │ │
                         │  │    憑證雙向驗證       │ │
                         │  └───────────────────────┘ │
                         │                             │
                         └──────────────┬──────────────┘
                                        │
                         ┌──────────────┴──────────────┐
                         │                             │
                         ▼                             ▼
                ┌────────────────┐           ┌────────────────┐
                │   社區防火牆   │           │  普渡雲平台    │
                │  (Firewall)    │           │ (第三方 API)   │
                └───────┬────────┘           └────────────────┘
                        │
             ┌──────────┴──────────┐
             │     獨立 VLAN       │
             │  (設備專用網段)     │
             └──────────┬──────────┘
                        │
          ┌─────────────┼─────────────┐
          │             │             │
          ▼             ▼             ▼
       ┌──────┐     ┌──────┐     ┌──────┐
       │ 站點 │     │ 站點 │     │ AMR  │
       │      │     │      │     │      │
       │ 憑證 │     │ 憑證 │     │ 憑證 │
       └──────┘     └──────┘     └──────┘
```

### 11.4 安全措施清單

```
┌─────────────────────┬─────────────────────────────────────────────────────┐
│ 層級                │ 措施                                                │
├─────────────────────┼─────────────────────────────────────────────────────┤
│ 網路層              │ • WPA3 企業版認證                                   │
│                     │ • 獨立 VLAN 隔離（設備與住戶網路分離）              │
│                     │ • MAC 位址過濾                                      │
│                     │ • 網路入侵偵測（IDS）                               │
├─────────────────────┼─────────────────────────────────────────────────────┤
│ 傳輸層              │ • TLS 1.3 強制加密                                  │
│                     │ • 憑證雙向驗證（mTLS）                              │
│                     │ • 憑證定期更換（90天）                              │
│                     │ • 憑證吊銷機制（CRL/OCSP）                          │
├─────────────────────┼─────────────────────────────────────────────────────┤
│ 應用層              │ • JWT Token（短效期 15 分鐘）                       │
│                     │ • API 請求簽名驗證（HMAC-SHA256）                   │
│                     │ • 指令序號防重放攻擊（Nonce + Timestamp）           │
│                     │ • Rate Limiting 防 DDoS                             │
├─────────────────────┼─────────────────────────────────────────────────────┤
│ 設備層              │ • 安全開機（Secure Boot）                           │
│                     │ • 韌體簽章驗證                                      │
│                     │ • 本地金鑰儲存（TPM / 安全晶片）                    │
│                     │ • 定期韌體更新                                      │
└─────────────────────┴─────────────────────────────────────────────────────┘
```

### 11.5 通訊協議總表

```
┌──────────────────────┬────────────────┬────────────────┬────────────────────┐
│ 連線                 │ 協議           │ 加密           │ 備註               │
├──────────────────────┼────────────────┼────────────────┼────────────────────┤
│ 雲平台 ↔ 站點        │ MQTT over TLS  │ TLS 1.3        │ QoS 1, 雙向憑證    │
├──────────────────────┼────────────────┼────────────────┼────────────────────┤
│ 雲平台 ↔ 普渡雲      │ HTTPS + WS     │ TLS 1.3        │ API Key + 簽名     │
├──────────────────────┼────────────────┼────────────────┼────────────────────┤
│ 站點 ↔ 機構控制      │ RS485          │ N/A（本地）    │ Modbus RTU         │
├──────────────────────┼────────────────┼────────────────┼────────────────────┤
│ 站點 ↔ 螢幕          │ HDMI + USB     │ N/A（本地）    │ 觸控輸入           │
├──────────────────────┼────────────────┼────────────────┼────────────────────┤
│ AMR ↔ 普渡雲         │ WiFi           │ 普渡自有       │ 普渡自有協議       │
├──────────────────────┼────────────────┼────────────────┼────────────────────┤
│ 4G 備援              │ LTE            │ TLS 1.3        │ 斷網自動切換       │
└──────────────────────┴────────────────┴────────────────┴────────────────────┘
```

### 11.6 網路設備清單與成本

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              網路設備清單（20層社區）                                    │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────┬──────┬──────────┬──────────┬────────────────────────┐
│ 設備                │ 數量 │ 單價     │ 小計     │ 備註                   │
├─────────────────────┼──────┼──────────┼──────────┼────────────────────────┤
│ 企業級 AP           │ 8    │ 3,500    │ 28,000   │ Ubiquiti U6-Pro 等級   │
│ 電梯專用 AP         │ 2    │ 5,000    │ 10,000   │ 防震、POE 供電         │
│ POE 交換機          │ 1    │ 8,000    │ 8,000    │ 8 port, 網管型         │
│ 防火牆/路由器       │ 1    │ 15,000   │ 15,000   │ VLAN、VPN 支援         │
│ 4G 模組（站點用）   │ 5    │ 2,500    │ 12,500   │ 大廳站 ×1 + 樓層站 ×4  │
│ 4G SIM 卡年費       │ 5    │ 6,000    │ 30,000   │ 500/月 × 12 月         │
│ 網路佈線工程        │ 1    │ 15,000   │ 15,000   │ CAT6 佈線              │
│ TLS 憑證（企業版）  │ 1    │ 5,000    │ 5,000    │ 年費                   │
├─────────────────────┼──────┼──────────┼──────────┼────────────────────────┤
│ **首年總計**        │      │          │**123,500**│                       │
│ **後續年費**        │      │          │ **35,000**│ SIM + 憑證            │
└─────────────────────┴──────┴──────────┴──────────┴────────────────────────┘
```

### 11.7 備選方案比較

```
┌────────────────┬────────────────┬────────────────┬────────────────┬────────────────┐
│ 方案           │ 信號穩定性     │ 資安等級       │ 首年成本       │ 適用場景       │
├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
│ 純 WiFi        │ ⚠️ 中          │ ⚠️ 中          │ ~50,000       │ 預算有限       │
├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
│ WiFi + 4G ★   │ ✅ 高          │ ✅ 高          │ ~120,000      │ 一般住宅社區   │
│ (推薦)         │                │                │               │                │
├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
│ WiFi + LoRa    │ ✅ 高          │ ✅ 高          │ ~150,000      │ 信號死角多     │
├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
│ 私有 5G        │ ✅✅ 極高      │ ✅✅ 極高      │ 3,000,000+    │ 企業/醫院      │
└────────────────┴────────────────┴────────────────┴────────────────┴────────────────┘
```

---

## 13. 待確認事項清單

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                  待確認事項清單                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘

【機構部門】

□ 貝拉 Pro 托盤 1 的尺寸（長 × 寬）
□ 貝拉 Pro 托盤 1 的高度（離地）
□ 貝拉 Pro 托盤是否有邊框？邊框高度？
□ 推送機構選型（伸縮皮帶 vs 推桿 vs 剪刀叉）
□ 推送機構伸出距離確認（目前設計 25cm）
□ 箱體底部是否需要滾輪或滑軌？

【電控部門】

□ 貝拉 Pro 停靠定位精度
□ 對位感測器選型（光電 vs 紅外 vs 視覺）
□ 推送機構馬達規格（扭力、速度）
□ 站點與 AMR 對接握手信號設計
□ 緊急停止機制設計

【軟體部門】

□ 普渡 API notifyRobotPose 座標精度（mm/cm/m）
□ 普渡 API 位置回報頻率（Hz）
□ 普渡 API 是否支援到達指定點位後回調
□ 普渡 API 電梯呼叫整合方式
□ 站點控制器與和椿雲平台通訊協議細節
```

---

## 14. 版本記錄

| 版本 | 日期 | 變更內容 |
|------|------|----------|
| v1.0 | 2025/12/30 | 初版，含推送機構設計方案 |
| v1.1 | 2025/12/30 | 新增通訊架構與網路安全章節 |

---

*文件用途*: 機構/電控/軟體 跨部門溝通
*維護人員*: SWAT Team
